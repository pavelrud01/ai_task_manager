# TDD Standard v1 (for AI Agent)

## Purpose
Обязательные правила качества для всех шагов workflow: Red→Green→Refactor, 5 Whys, DOD, инциденты, метрики.

## Red→Green→Refactor
- Red: перед генерацией решения сформулируй проверяемые критерии и риски (минимум 3), что может пойти не так.
- Green: выдай результат, проверь его по контракту (JSON-схема) и чеклистам стандарта шага.
- Refactor: если провал — сделай **5 Whys** и переработай вывод. Внеси правки и повторно проверь.

## 5 Whys (обязательно при провале)
Всегда ответь на вопросы:
1) Почему результат не прошёл?  
2) Почему причина №1 возникла?  
3) Почему причина №2 возникла?  
4) Почему причина №3 возникла?  
5) Почему корневая причина не была учтена изначально?  
Итог: краткий план фикса (3–5 пунктов), что меняешь в следующей итерации.

## DOD — Definition of Done
Шаг считается «готов» только если:
- Пройден контракт (JSON-schema) для артефакта шага.
- Выполнен чек-лист стандарта шага (Quality Checklist).
- Uncertainty ≤ порога; если выше — заданы уточняющие вопросы/HITL.
- Зафиксированы заметки о рисках/долгах, если остались компромиссы.

## Incident Protocol
Если шаг упал или дал сомнительный результат:
- Запиши коротко: «Что произошло», «5 Whys summary», «Что исправлено».
- Сохрани ссылку на артефакт/логи. Продолжай только после фикса.

## Metrics
Для каждого шага логируй: 
- passed_contract (true/false), passed_checklist (true/false),
- uncertainty (0–1), attempts_count, duration_sec.

## Output Contract Hints
Каждый шаг добавляет в `notes`:
- `tdd_cycle`: "red/green/refactor"
- `five_whys`: краткое резюме, если была неудача
- `dod_passed`: true/false
- `incident`: если был, короткое описание

**Follow strictly.**
